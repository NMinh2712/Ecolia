# SoulGem AI - Bracelet Recommendation System

## Overview

**SoulGem AI** is a rule-based, deterministic recommendation engine for personalized energy bracelets. It analyzes 10 user inputs to deliver a unique bracelet design with healing stones, charm suggestions, layout recommendations, and personalized energy readings.

## System Architecture

### Core Files

- **`lib/get-bracelet-recommendation.ts`** - Main recommendation engine with rule-based logic
- **`app/api/recommend-bracelet/route.ts`** - REST API endpoint for programmatic access
- **`app/ai-reading/page.tsx`** - 10-question form interface
- **`app/ai-processing/page.tsx`** - Processing animation + recommendation generation
- **`app/ai-result/page.tsx`** - Detailed result display with bracelet specs

## Input Schema

```typescript
interface BraceletRecommendationInput {
  // Part 1: Identity & Zodiac
  ngaySinh?: string           // Format: "YYYY-MM-DD"
  gioiTinh?: string           // "male" | "female" | "other"
  
  // Part 2: Emotional State
  trangThaiTinhThan?: string  // "stress" | "lost" | "anxious" | "angry" | "bored" | "happy"
  
  // Part 3: Life Barrier
  raoCan?: string             // "procrastination" | "confidence" | "bad_luck" | "health"
  
  // Part 4: Life Mission
  suMenh?: string             // "wealth" | "love" | "wisdom" | "health"
  
  // Part 5: Energy Vibe
  vibe?: string               // "mạnh" | "nhẹ" | "bí ẩn"
  
  // Part 6: Fashion Style
  phongCach?: string          // "minimal" | "nổi loạn" | "vintage" | "nữ tính" | "cân bằng"
  
  // Part 7: Color Preference (Negative Filter)
  mauKhongMuon?: string       // "tối" | "nóng" | "nhiều" | "không"
  
  // Part 8: Physical Specs
  coTayCm?: number            // 14-20
  nganSach?: number           // 99000 | 149000 | 199000
  
  // Part 9: Custom Affirmation
  affirmation?: string
  
  // Part 10: Name
  name?: string
}
```

## Recommendation Output Schema

```typescript
interface BraceletRecommendation {
  project: {
    name: string                    // "SoulGem AI"
    concept: string
    businessModel: string           // "D2C"
  }
  input: BraceletRecommendationInput
  result: {
    tomTatChanDung: string[]        // 3-4 key points
    vongTayDeXuat: {
      tenVong: string               // Generated bracelet name
      vibe: string
      phongCach: string
      coTayCm: number
      nganSach: number
      kichThuocHatMm: number        // 6 or 8
      soHatDuKien: string           // "17-19" | "19-21" | etc.
      bangDa: [                     // Always 4 stones
        {
          vaiTro: "main" | "healing" | "boost" | "theme"
          tenDa: string             // Stone name
          mauSac: string            // Hex color
          yNghia: string            // Meaning/benefit
        }
      ]
      charmGoiY: [
        { tenCharm: string; yNghia: string }
      ]
      layoutDeXuat: string
      mauChuDao: string[]           // 2 hex colors
      negativeFiltersApplied: string[]
      lyDoChon: string[]            // 3+ reasons
    }
    readingCard: {
      tieuDe: string
      thongDiepChinh: string
      giaiThichNgan: string[]
      affirmation: {
        text: string
        autoGenerated: boolean
      }
    }
  }
}
```

## Rule Engine Logic

### 1. Healing Stone Selection (Emotional State)

Maps emotional state to a supporting stone:

| Emotional State | Healing Stone | Benefit |
|---|---|---|
| Căng thẳng (stress) | Thạch anh tím | Giảm stress, bình tĩnh tâm trí |
| Mông lung (lost) | Fluorite | Tập trung, rõ ràng |
| Bất an (anxious) | Đá mặt trăng | An thần, cân bằng |
| Nóng nảy (angry) | Aquamarine | Hạ nhiệt, bình tĩnh |
| Tẻ nhạt (bored) | Thạch anh vàng | Tạo năng lượng tích cực |
| Vui vẻ (happy) | Thạch anh hồng | Duy trì rung động mềm mại |

**Fallback:** `Thạch anh tím`

### 2. Boost Stone Selection (Life Barrier)

Helps overcome current obstacles:

| Barrier | Boost Stone | Benefit |
|---|---|---|
| Sự trì hoãn (procrastination) | Mắt hổ | Tập trung, hành động |
| Thiếu tự tin (confidence) | Đá mặt trời | Tự tin, tỏa sáng |
| Xui xẻo (bad_luck) | Obsidian đen | Bảo vệ, xua đi năng lượng xấu |
| Sức khỏe (health) | Thạch anh xanh | Hồi phục, cân bằng |

**Fallback:** `Mắt hổ`

### 3. Main Stone Selection (Natural Element)

Based on zodiac/element preference:

| Element | Main Stone |
|---|---|
| Hỏa (Fire) | Thạch anh vàng |
| Thủy (Water) | Aquamarine |
| Thổ (Earth) | Fluorite |
| Khí (Air) | Thạch anh trắng |
| Kim (Metal) | Obsidian đen |

**Fallback:** `Thạch anh trắng`

### 4. Theme Stone Selection (Life Goal)

Aligned with user's primary intention:

| Goal | Theme Stone | Supporting Stone |
|---|---|---|
| Tài lộc (wealth) | Thạch anh vàng | - |
| Tình yêu (love) | Thạch anh hồng | Đá mặt trăng |
| Trí tuệ (wisdom) | Fluorite | Thạch anh trắng |
| Sức khỏe (health) | Thạch anh tím | Obsidian đen |

**Fallback:** `Thạch anh vàng`

## Physical Specifications

### Bead Size
- Budget ≥ 149,000 VND → 8mm beads
- Budget < 149,000 VND → 6mm beads

### Bead Count (by wrist circumference)
- 14-15cm → 17-19 beads
- 16-17cm → 19-21 beads (standard)
- 18-19cm → 21-23 beads
- 20cm+ → 23-25 beads

### Layout Recommendations

Based on fashion style + energy vibe:

- **Tối giản (Minimal):** 1-2 stone types, single charm, clean design
- **Nổi loạn (Bold):** High contrast, prominent accents, rebellious layout
- **Vintage:** Warm tones, matte stones, classic charms
- **Nữ tính (Feminine):** Pink/purple tones, heart/flower charms, soft layout
- **Cân bằng (Balanced):** Even distribution, versatile, moderate accent

## Negative Filter Logic

Applied when user specifies unwanted color/aesthetic:

### Dark Tone Filter
- **If:** "Không muốn tông tối/đen"
- **Action:** Remove Obsidian đen, replace with Thạch anh trắng or Đá mặt trăng
- **Reason:** Maintain protection benefit with lighter stone

### Warm Tone Filter
- **If:** "Không muốn tông nóng/rực"
- **Action:** Reduce red/orange stones, prioritize cool tones

### Simplification Filter
- **If:** "Không muốn quá sặc sỡ"
- **Action:** Max 2 main stones + 1 neutral (Thạch anh trắng)

### No Preference
- **If:** "Không kén chọn"
- **Action:** No filters applied

## Affirmation Generation

### User-Provided Affirmation
- If filled in → Use directly
- Mark `autoGenerated: false`

### Auto-Generated Affirmation
- If empty → Generate based on emotional state
- Map to pre-defined affirmations:
  - **Stress** → "Tôi bình an, tôi mạnh mẽ..."
  - **Lost** → "Tôi tin vào quá trình..."
  - **Anxious** → "Tôi an toàn, tôi được bảo vệ..."
  - **Angry** → "Tôi bình tĩnh, tôi kiểm soát..."
  - **Bored** → "Tôi rực rỡ, tôi có năng lượng..."
  - **Happy** → "Tôi duy trì vui vẻ..."
- Mark `autoGenerated: true`

## Charm Suggestions

Recommended charms based on life goal:

| Goal | Suggested Charms | Meaning |
|---|---|---|
| Wealth | Tiền Tài, Sự Nghiệp | 财富, 晋升 |
| Love | Trái Tim, Đôi Cánh | Kết nối, Tự do |
| Wisdom | Sách, Mắt Thứ Ba | Học tập, Trực giác |
| Health | Hoa Sen, Cây Sống | Tinh khiết, Sức sống |

## Color Palette

### Stone Color Mapping

```json
{
  "Thạch anh trắng": "#F5F5F5",
  "Thạch anh tím": "#9966CC",
  "Mắt hổ": "#B8860B",
  "Thạch anh vàng": "#FFD700",
  "Thạch anh hồng": "#FFB6C1",
  "Đá mặt trăng": "#E8D5D5",
  "Aquamarine": "#7FFFD4",
  "Fluorite": "#B0C4DE",
  "Thạch anh xanh": "#1E90FF",
  "Obsidian đen": "#1C1C1C",
  "Đá mặt trời": "#FFA500"
}
```

## API Usage

### Endpoint
```
POST /api/recommend-bracelet
```

### Request Example
```json
{
  "ngaySinh": "1990-05-15",
  "gioiTinh": "female",
  "trangThaiTinhThan": "stress",
  "raoCan": "procrastination",
  "suMenh": "wealth",
  "vibe": "gentle",
  "phongCach": "minimalist",
  "mauKhongMuon": "any",
  "coTayCm": 16,
  "nganSach": 149000,
  "affirmation": "Tôi bình an và thành công",
  "name": "Minh"
}
```

### Response Example
```json
{
  "project": { "name": "SoulGem AI", ... },
  "input": { ... },
  "result": {
    "tomTatChanDung": [ ... ],
    "vongTayDeXuat": {
      "tenVong": "Vòng Tài Lộc",
      "bangDa": [
        {
          "vaiTro": "main",
          "tenDa": "Thạch anh vàng",
          "mauSac": "#FFD700",
          "yNghia": "Tạo năng lượng tích cực..."
        },
        ...
      ],
      ...
    },
    "readingCard": { ... }
  }
}
```

## Fallback Strategy

All fields have smart fallbacks to ensure consistent output:

| Field | Missing Value | Fallback |
|---|---|---|
| trangThaiTinhThan | Empty | "happy" |
| raoCan | Empty | "procrastination" |
| suMenh | Empty | "health" |
| vibe | Empty | "Nhẹ nhàng" |
| phongCach | Empty | "Cân bằng" |
| coTayCm | Empty | 16 |
| nganSach | Empty | 99000 |
| affirmation | Empty | Auto-generated |

## Integration Points

### Frontend Flow
1. **Form Collection** (`/ai-reading`) → 10 questions
2. **Processing** (`/ai-processing`) → Calls engine
3. **Result Display** (`/ai-result`) → Shows recommendation + reading card

### Backend Flow
1. User submits form → Data stored in sessionStorage
2. Processing page triggers `getBraceletRecommendation()`
3. Result saved to sessionStorage
4. Display page renders full recommendation

## Performance & Reliability

- **Processing Time:** <100ms (synchronous rule-based)
- **Output Format:** Always valid JSON, never empty or null
- **Error Handling:** Graceful fallbacks for all missing inputs
- **Deterministic:** Same input always produces same output

## Future Enhancements

1. **AI-Enhanced Personalization:** Integrate LLM for reading card text generation
2. **User Preference Learning:** Track bracelet effectiveness over time
3. **Inventory Matching:** Real-time stone availability mapping
4. **PDF Export:** Generate printable "Reading Card" certificates
5. **Social Sharing:** Instagram-ready bracelet design previews
6. **A/B Testing:** Compare recommendation strategies

## Maintenance

- Stone database: Update `STONE_COLORS` and `STONE_MEANINGS` as collection grows
- Fallback values: Adjust based on sales performance
- Affirmations: Add seasonal/event-specific affirmations
- Validation: Regular testing with new user demographics
